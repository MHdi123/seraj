{% extends "base.html" %}

{% block title %}Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ - Ø³ÙØ±Ø§Ø¬{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¢Ù…Ø§Ø±</h1>
        <p class="text-gray-600">Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø³ÙØ±Ø§Ø¬</p>
    </div>
    
    <!-- Stats Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
        <div class="card">
            <div class="card-body text-center">
                <div class="text-3xl font-bold text-blue-600 mb-2" id="totalParticipants">0</div>
                <p class="text-gray-600">Ú©Ù„ Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†</p>
            </div>
        </div>
        <div class="card">
            <div class="card-body text-center">
                <div class="text-3xl font-bold text-green-600 mb-2" id="totalEvents">0</div>
                <p class="text-gray-600">Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø¨Ø±Ú¯Ø²Ø§Ø± Ø´Ø¯Ù‡</p>
            </div>
        </div>
        <div class="card">
            <div class="card-body text-center">
                <div class="text-3xl font-bold text-purple-600 mb-2" id="dailyRegistrations">0</div>
                <p class="text-gray-600">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Û³Û° Ø±ÙˆØ²</p>
            </div>
        </div>
        <div class="card">
            <div class="card-body text-center">
                <div class="text-3xl font-bold text-yellow-600 mb-2" id="avgParticipants">0</div>
                <p class="text-gray-600">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø´Ø±Ú©Øªâ€ŒÚ©Ù†Ù†Ø¯Ú¯Ø§Ù†</p>
            </div>
        </div>
    </div>

    <!-- Event Participation -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
            <div class="card">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h2>
                </div>
                <div class="card-body">
                    {% if event_participation %}
                    <div class="space-y-4" id="eventList">
                        {% for item in event_participation %}
                        <div class="border border-gray-200 rounded-lg p-4 event-item" data-participants="{{ item.participants }}">
                            <div class="flex justify-between items-center mb-2">
                                <h3 class="font-medium text-gray-800">{{ item.title }}</h3>
                                <span class="badge badge-{{ item.event_type_value }}">
                                    {% if item.event_type_value == 'workshop' %}Ú©Ø§Ø±Ú¯Ø§Ù‡
                                    {% elif item.event_type_value == 'competition' %}Ù…Ø³Ø§Ø¨Ù‚Ù‡
                                    {% elif item.event_type_value == 'halaqah' %}Ø­Ù„Ù‚Ù‡ ØªÙ„Ø§ÙˆØª
                                    {% elif item.event_type_value == 'lecture' %}Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ
                                    {% else %}Ø¯ÛŒÚ¯Ø±{% endif %}
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-users ml-2"></i>
                                    <span class="participant-count">{{ item.participants }}</span> Ù†ÙØ±
                                </div>
                                <div class="w-32 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full progress-bar"></div>
                                </div>
                            </div>
                            <div class="mt-2 text-xs text-gray-500">
                                <i class="fas fa-calendar ml-1"></i> {{ item.start_date|persian_date }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-chart-bar text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-600">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Daily Registrations -->
        <div>
            <div class="card">
                <div class="card-header">
                    <h2 class="text-xl font-bold">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h2>
                </div>
                <div class="card-body">
                    {% if daily_registrations %}
                    <div class="space-y-3" id="dailyList">
                        {% for day in daily_registrations %}
                        <div class="flex items-center justify-between day-item" data-count="{{ day.count }}">
                            <div class="text-sm text-gray-600">{{ day.date }}</div>
                            <div class="flex items-center">
                                <div class="w-24 bg-gray-200 rounded-full h-2 ml-3">
                                    <div class="bg-green-600 h-2 rounded-full day-progress-bar"></div>
                                </div>
                                <span class="text-sm font-medium day-count">{{ day.count }} Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-calendar-alt text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-600">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- University Statistics -->
    <div class="mt-8">
        <div class="card">
            <div class="card-header">
                <h2 class="text-xl font-bold">Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</h2>
            </div>
            <div class="card-body">
                {% if university_stats %}
                {% set max_university = university_stats|map(attribute='count')|max %}
                <div class="space-y-3" id="universityList">
                    {% for uni in university_stats %}
                    <div class="flex items-center justify-between university-item" data-count="{{ uni.count }}">
                        <div class="text-sm font-medium text-gray-700">{{ uni.university }}</div>
                        <div class="flex items-center">
                            <div class="w-24 bg-gray-200 rounded-full h-2 ml-3">
                                <div class="bg-purple-600 h-2 rounded-full university-progress-bar"></div>
                            </div>
                            <span class="text-sm font-medium">{{ uni.count }} Ú©Ø§Ø±Ø¨Ø±</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8">
                    <i class="fas fa-university text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-600">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Export Options -->
    <div class="mt-8">
        <div class="card">
            <div class="card-header">
                <h2 class="text-xl font-bold">Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´</h2>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="btn btn-secondary" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf ml-2"></i> Ø®Ø±ÙˆØ¬ÛŒ PDF
                    </button>
                    <button class="btn btn-secondary" onclick="exportToExcel()">
                        <i class="fas fa-file-excel ml-2"></i> Ø®Ø±ÙˆØ¬ÛŒ Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportToCSV()">
                        <i class="fas fa-file-csv ml-2"></i> Ø®Ø±ÙˆØ¬ÛŒ CSV
                    </button>
                    <button class="btn btn-primary" onclick="window.print()">
                        <i class="fas fa-print ml-2"></i> Ú†Ø§Ù¾ Ú¯Ø²Ø§Ø±Ø´
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ================== Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø³Øª Ú©Ø±Ø¯Ù† Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª ==================
document.addEventListener('DOMContentLoaded', function() {
    // Event bars
    const eventItems = document.querySelectorAll('.event-item');
    let totalParticipants = 0;
    let maxParticipants = 0;
    eventItems.forEach(item => {
        const count = parseInt(item.dataset.participants || 0);
        totalParticipants += count;
        if(count > maxParticipants) maxParticipants = count;
    });
    eventItems.forEach(item => {
        const bar = item.querySelector('.progress-bar');
        const count = parseInt(item.dataset.participants || 0);
        if(bar && maxParticipants>0) bar.style.width = Math.round(count/maxParticipants*100) + '%';
    });
    document.getElementById('totalParticipants').textContent = totalParticipants;
    document.getElementById('totalEvents').textContent = eventItems.length;
    document.getElementById('avgParticipants').textContent = eventItems.length>0 ? Math.round(totalParticipants/eventItems.length) : 0;

    // Daily bars
    const dayItems = document.querySelectorAll('.day-item');
    let totalDaily = 0;
    let maxDaily = 0;
    dayItems.forEach(item => {
        const count = parseInt(item.dataset.count || 0);
        totalDaily += count;
        if(count>maxDaily) maxDaily=count;
    });
    dayItems.forEach(item => {
        const bar = item.querySelector('.day-progress-bar');
        const count = parseInt(item.dataset.count || 0);
        if(bar && maxDaily>0) bar.style.width = Math.round(count/maxDaily*100) + '%';
    });
    document.getElementById('dailyRegistrations').textContent = totalDaily;

    // University bars
    const uniItems = document.querySelectorAll('.university-item');
    let maxUni = Math.max(...Array.from(uniItems).map(u=>parseInt(u.dataset.count || 0)));
    uniItems.forEach(item=>{
        const bar = item.querySelector('.university-progress-bar');
        const count = parseInt(item.dataset.count || 0);
        if(bar && maxUni>0) bar.style.width = Math.round(count/maxUni*100) + '%';
    });
});

// ================== Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ ==================
function exportToPDF(){ alert('ğŸ“„ Ù‚Ø§Ø¨Ù„ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ PDF Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'); }
function exportToExcel(){ alert('ğŸ“Š Ù‚Ø§Ø¨Ù„ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ Excel Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'); }
function exportToCSV(){ alert('ğŸ“‘ Ù‚Ø§Ø¨Ù„ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ CSV Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'); }
</script>

<style>
.progress-bar, .day-progress-bar, .university-progress-bar {
    transition: width 0.5s ease-in-out;
    width: 0;
}
.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 9999px;
}
.badge-workshop { background-color: #dbeafe; color: #1e40af; }
.badge-competition { background-color: #dcfce7; color: #166534; }
.badge-halaqah { background-color: #f3e8ff; color: #6b21a8; }
.badge-lecture { background-color: #fef9c3; color: #854d0e; }
.badge-other { background-color: #f1f5f9; color: #334155; }

@media print {
    .btn, .card-header a, footer, header, .no-print { display: none !important; }
}
</style>
{% endblock %}
