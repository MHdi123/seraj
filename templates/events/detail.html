{% extends "base.html" %}

{% block title %}{{ event.title }} - سِراج{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Event Header -->
    <div class="card mb-8">
        <div class="card-header">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <span class="badge badge-{{ event.event_type.value }} text-lg">
                        {% if event.event_type.value == 'workshop' %}
                            کارگاه آموزشی
                        {% elif event.event_type.value == 'competition' %}
                            مسابقه قرآنی
                        {% elif event.event_type.value == 'halaqah' %}
                            حلقه تلاوت و تدبر
                        {% elif event.event_type.value == 'lecture' %}
                            سخنرانی
                        {% else %}
                            برنامه ویژه
                        {% endif %}
                    </span>
                </div>
                
                {% if event.is_full() %}
                    <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">
                        <i class="fas fa-exclamation-triangle ml-2"></i>
                        تکمیل ظرفیت
                    </span>
                {% endif %}
            </div>
            
            <h1 class="text-2xl font-bold mb-4">{{ event.title }}</h1>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="flex items-center">
                    <i class="fas fa-calendar text-blue-600 ml-3"></i>
                    <div>
                        <div class="text-sm text-gray-500">تاریخ</div>
                        <div class="font-medium">{{ event.start_date.strftime('%Y/%m/%d') }}</div>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <i class="fas fa-clock text-green-600 ml-3"></i>
                    <div>
                        <div class="text-sm text-gray-500">ساعت</div>
                        <div class="font-medium">{{ event.start_date.strftime('%H:%M') }}</div>
                    </div>
                </div>
                
                {% if event.location %}
                    <div class="flex items-center">
                        <i class="fas fa-map-marker-alt text-purple-600 ml-3"></i>
                        <div>
                            <div class="text-sm text-gray-500">مکان</div>
                            <div class="font-medium">{{ event.location }}</div>
                        </div>
                    </div>
                {% endif %}
                
                <div class="flex items-center">
                    <i class="fas fa-users text-yellow-600 ml-3"></i>
                    <div>
                        <div class="text-sm text-gray-500">شرکت‌کنندگان</div>
                        <div class="font-medium">
                            {{ event.current_participants }}/{{ event.capacity if event.capacity else 'نامحدود' }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            <!-- Description -->
            <div class="mb-8">
                <h2 class="text-xl font-bold mb-4">توضیحات رویداد</h2>
                <div class="bg-gray-50 rounded-lg p-6 whitespace-pre-line">
                    {{ event.description }}
                </div>
            </div>
            
            <!-- Registration Form -->
            {% if current_user.is_authenticated %}
                <div class="border-t border-gray-200 pt-6">
                    {% if is_registered %}
                        <div class="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-check text-green-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-green-700 mb-2">شما در این رویداد ثبت‌نام کرده‌اید</h3>
                            <p class="text-green-600 mb-4">اطلاعات دقیق‌تر از طریق اعلان‌ها به شما اطلاع داده خواهد شد.</p>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-green">
                                <i class="fas fa-tachometer-alt ml-2"></i>
                                مشاهده داشبورد
                            </a>
                        </div>
                    {% elif event.is_full() %}
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-times text-red-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-red-700 mb-2">ظرفیت این رویداد تکمیل شده است</h3>
                            <p class="text-red-600">متأسفانه امکان ثبت‌نام در این رویداد وجود ندارد.</p>
                        </div>
                    {% elif event.is_active %}
                        <form method="POST" action="{{ url_for('register_for_event', event_id=event.id) }}">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h3 class="text-xl font-bold text-blue-700 mb-4">ثبت‌نام در رویداد</h3>
                                
                                <div class="space-y-4 mb-6">
                                    <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                        <span class="text-gray-700">ظرفیت باقی‌مانده:</span>
                                        <span class="font-bold text-blue-600">
                                            {% if event.capacity %}
                                                {{ event.capacity - event.current_participants }} نفر
                                            {% else %}
                                                نامحدود
                                            {% endif %}
                                        </span>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                        <span class="text-gray-700">تاریخ برگزاری:</span>
                                        <span class="font-medium">{{ event.start_date.strftime('%Y/%m/%d - %H:%M') }}</span>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-full py-3 text-lg">
                                    <i class="fas fa-user-check ml-2"></i>
                                    ثبت‌نام در این رویداد
                                </button>
                            </div>
                        </form>
                    {% else %}
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
                            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-yellow-700 mb-2">این رویداد غیرفعال است</h3>
                            <p class="text-yellow-600">امکان ثبت‌نام در رویدادهای غیرفعال وجود ندارد.</p>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <div class="border-t border-gray-200 pt-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-user-plus text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-blue-700 mb-2">برای ثبت‌نام وارد شوید</h3>
                        <p class="text-blue-600 mb-4">برای ثبت‌نام در این رویداد باید وارد حساب کاربری خود شوید.</p>
                        <div class="flex gap-4 justify-center">
                            <a href="{{ url_for('login') }}" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt ml-2"></i>
                                ورود به سیستم
                            </a>
                            <a href="{{ url_for('register') }}" class="btn btn-secondary">
                                <i class="fas fa-user-plus ml-2"></i>
                                ثبت‌نام
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Back Button -->
    <div class="text-center">
        <a href="{{ url_for('events_list') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-right ml-2"></i>
            بازگشت به لیست رویدادها
        </a>
    </div>
</div>
{% endblock %}